<!-- build time:Fri Mar 24 2023 10:37:54 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Hexo" href="https://staysunny66.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Hexo" href="https://staysunny66.github.io/atom.xml"><link rel="alternate" type="application/json" title="Hexo" href="https://staysunny66.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Zigbee,Zstack,DHT11"><link rel="canonical" href="https://staysunny66.github.io/2022/12/07/ZIGBEE%E6%B8%A9%E6%B9%BF%E5%BA%A6%E4%BC%A0%E6%84%9F%E5%99%A8%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/"><title>ZIGBEE温湿度传感器代码分析 - 嵌入式开发 | 矢光小屋 = Hexo</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">ZIGBEE温湿度传感器代码分析</h1><div class="meta"><span class="item" title="创建时间：2022-12-07 09:59:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-12-07T09:59:00+08:00">2022-12-07</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">矢光小屋</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://s1.ax1x.com/2023/03/23/pp0PzKf.jpg"></li><li class="item" data-background-image="https://s1.ax1x.com/2023/03/23/pp0PbUH.jpg"></li><li class="item" data-background-image="https://s1.ax1x.com/2023/03/23/pp0Pq5d.jpg"></li><li class="item" data-background-image="https://s1.ax1x.com/2023/03/23/pp0POPA.jpg"></li><li class="item" data-background-image="https://s1.ax1x.com/2023/03/23/pp0iSr8.jpg"></li><li class="item" data-background-image="https://s1.ax1x.com/2023/03/23/pp0Pj2t.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/" itemprop="item" rel="index" title="分类于 嵌入式开发"><span itemprop="name">嵌入式开发</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://staysunny66.github.io/2022/12/07/ZIGBEE%E6%B8%A9%E6%B9%BF%E5%BA%A6%E4%BC%A0%E6%84%9F%E5%99%A8%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="晚晴"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Hexo"></span><div class="body md" itemprop="articleBody"><h3 id="传感器介绍"><a class="anchor" href="#传感器介绍">#</a> 传感器介绍</h3><h4 id="产品详细介绍"><a class="anchor" href="#产品详细介绍">#</a> 产品详细介绍</h4><p>DHT11 数字温湿度传感器是一款含有已校准数字信号输出的温湿度复合传感器，它应用专用的数字模块采集技术和温湿度传感技术，确保产品具有极高的可靠性和卓越的长期稳定性。传感器包括一个电阻式感湿元件和一个 NTC 测温元件，并与一个高性能 8 位单片机相连接。因此该产品具有品质卓越、超快响应、抗干扰能力强、性价比极高等优点。每个 DHT11 传感器都在极为精确的湿度校验室中进行校准。校准系数以程序的形式存在 OTP 内存中，传感器内部在检测信号的处理过程中要调用这些校准系数。单线制串行接口，使系统集成变得简易快捷。超小的体积、极低的功耗，使其成为该类应用中，在苛刻应用场合的最佳选择。产品为 4 针单排引脚封装，连接方便。</p><h4 id="典型应用电路"><a class="anchor" href="#典型应用电路">#</a> 典型应用电路</h4><p><img data-src="/StaySunny66/images%5Cpasted-8.png" alt="upload successful"></p><h3 id="传感器协议"><a class="anchor" href="#传感器协议">#</a> 传感器协议</h3><h4 id="单总线onewire协议介绍"><a class="anchor" href="#单总线onewire协议介绍">#</a> 单总线（OneWire）协议介绍</h4><p>1-wire 单总线是 Maxim 全资子公司 Dallas 的一项专有技术与目前多数标准串行数据通信方式，如 SPI/I2C/MICROWIRE 不同，它采用单根信号线，既传输时钟又传输数据，而且数据传输是双向的。它具有节省 I/O 口线资源、结构简单、成本低廉、便于总线扩展和维护等诸多优点。</p><h4 id="协议图示"><a class="anchor" href="#协议图示">#</a> 协议图示</h4><p><img data-src="/StaySunny66/images%5Cpasted-9.png" alt="upload successful"></p><p><img data-src="/StaySunny66/images%5Cpasted-10.png" alt="upload successful"></p><p><img data-src="/StaySunny66/images%5Cpasted-11.png" alt="upload successful"></p><h3 id="代码分析"><a class="anchor" href="#代码分析">#</a> 代码分析</h3><h4 id="裸机代码"><a class="anchor" href="#裸机代码">#</a> 裸机代码</h4><figure class="highlight c"><figcaption data-lang="c"><span>c</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ioCC2530.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">uint</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">int</span></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">uchar</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">char</span></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">wenshi</span> <span class="token expression">P0_6</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 温湿度定义</span></pre></td></tr><tr><td data-num="9"></td><td><pre>uchar ucharFLAG<span class="token punctuation">,</span>uchartemp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>uchar shidu_shi<span class="token punctuation">,</span>shidu_ge<span class="token punctuation">,</span>wendu_shi<span class="token punctuation">,</span>wendu_ge<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>uchar ucharT_data_H<span class="token punctuation">,</span>ucharT_data_L<span class="token punctuation">,</span>ucharRH_data_H<span class="token punctuation">,</span>ucharRH_data_L<span class="token punctuation">,</span>ucharcheckdata<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>uchar ucharT_data_H_temp<span class="token punctuation">,</span>ucharT_data_L_temp<span class="token punctuation">,</span>ucharRH_data_H_temp<span class="token punctuation">,</span>ucharRH_data_L_temp<span class="token punctuation">,</span>ucharcheckdata_temp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>uchar ucharcomdata<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>uchar temp<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="16"></td><td><pre>uchar temp1<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"temp="</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>uchar humidity<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>uchar humidity1<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"humidity="</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">/****************************</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        延时函数</pre></td></tr><tr><td data-num="22"></td><td><pre>*****************************/</pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">void</span> <span class="token function">Delay_us</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//1 us 延时</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">asm</span><span class="token punctuation">(</span><span class="token string">"nop"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">asm</span><span class="token punctuation">(</span><span class="token string">"nop"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">asm</span><span class="token punctuation">(</span><span class="token string">"nop"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">asm</span><span class="token punctuation">(</span><span class="token string">"nop"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">asm</span><span class="token punctuation">(</span><span class="token string">"nop"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">asm</span><span class="token punctuation">(</span><span class="token string">"nop"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">asm</span><span class="token punctuation">(</span><span class="token string">"nop"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">asm</span><span class="token punctuation">(</span><span class="token string">"nop"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token keyword">asm</span><span class="token punctuation">(</span><span class="token string">"nop"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token keyword">void</span> <span class="token function">Delay_10us</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//10 us 延时</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>  <span class="token function">Delay_us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>  <span class="token function">Delay_us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>  <span class="token function">Delay_us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>  <span class="token function">Delay_us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>  <span class="token function">Delay_us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  <span class="token function">Delay_us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>  <span class="token function">Delay_us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>  <span class="token function">Delay_us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>  <span class="token function">Delay_us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>  <span class="token function">Delay_us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   </pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token keyword">void</span> <span class="token function">Delay_ms</span><span class="token punctuation">(</span>uint Time<span class="token punctuation">)</span><span class="token comment">//n ms 延时</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>  <span class="token keyword">while</span><span class="token punctuation">(</span>Time<span class="token operator">--</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="56"></td><td><pre>     <span class="token function">Delay_10us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token comment">/***********************</span></pre></td></tr><tr><td data-num="62"></td><td><pre>   温湿度传感</pre></td></tr><tr><td data-num="63"></td><td><pre>***********************/</pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token keyword">void</span> <span class="token function">COM</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>	<span class="token comment">// 温湿写入</span></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>    uchar i<span class="token punctuation">;</span>          </pre></td></tr><tr><td data-num="67"></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>  <span class="token comment">///for 循环 8 次 每次读 一个位  </span></pre></td></tr><tr><td data-num="68"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>     ucharFLAG<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="70"></td><td><pre>     <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>wenshi<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>ucharFLAG<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 等 DHT11 拉高</span></pre></td></tr><tr><td data-num="71"></td><td><pre>     <span class="token function">Delay_10us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>     <span class="token function">Delay_10us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>     <span class="token function">Delay_10us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/// 30 us 之后</span></pre></td></tr><tr><td data-num="74"></td><td><pre>     uchartemp<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>     <span class="token keyword">if</span><span class="token punctuation">(</span>wenshi<span class="token punctuation">)</span>uchartemp<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 如果还是 高 得 bit = 1 </span></pre></td></tr><tr><td data-num="76"></td><td><pre>     ucharFLAG<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>            <span class="token comment">// 否则 bit = 0</span></pre></td></tr><tr><td data-num="77"></td><td><pre>     <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>wenshi<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>ucharFLAG<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 等待拉低</span></pre></td></tr><tr><td data-num="78"></td><td><pre>     <span class="token keyword">if</span><span class="token punctuation">(</span>ucharFLAG<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token comment">/// 超时吗？？ 不太懂    </span></pre></td></tr><tr><td data-num="79"></td><td><pre>     ucharcomdata<span class="token operator">&lt;&lt;=</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 左移一位</span></pre></td></tr><tr><td data-num="80"></td><td><pre>     ucharcomdata<span class="token operator">|=</span>uchartemp<span class="token punctuation">;</span> <span class="token comment">// 把读取到的赋值</span></pre></td></tr><tr><td data-num="81"></td><td><pre>     <span class="token punctuation">&#125;</span>    </pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="83"></td><td><pre></pre></td></tr><tr><td data-num="84"></td><td><pre><span class="token keyword">void</span> <span class="token function">DHT11</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>   <span class="token comment">// 温湿传感启动</span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="86"></td><td><pre>    wenshi<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">// 先将 DATA 数据线接口拉低</span></pre></td></tr><tr><td data-num="87"></td><td><pre>    <span class="token function">Delay_ms</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//  延迟大于 18 毫秒 复位</span></pre></td></tr><tr><td data-num="88"></td><td><pre>    wenshi<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>     <span class="token comment">/// 拉高 DATA 数据线</span></pre></td></tr><tr><td data-num="89"></td><td><pre>    P0DIR <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token number">0x40</span><span class="token punctuation">;</span> <span class="token comment">// 将 DATA 接口 从 输出 设置为输入</span></pre></td></tr><tr><td data-num="90"></td><td><pre>    <span class="token function">Delay_10us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     </pre></td></tr><tr><td data-num="91"></td><td><pre>    <span class="token function">Delay_10us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>						</pre></td></tr><tr><td data-num="92"></td><td><pre>    <span class="token function">Delay_10us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>    <span class="token function">Delay_10us</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">/// 延时 40 us  拉低了 40 us</span></pre></td></tr><tr><td data-num="94"></td><td><pre>     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>wenshi<span class="token punctuation">)</span>    <span class="token comment">// 此时 DHT11 应该 拉低 DATA 数据线</span></pre></td></tr><tr><td data-num="95"></td><td><pre>     <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="96"></td><td><pre>      ucharFLAG<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="97"></td><td><pre>      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>wenshi<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>ucharFLAG<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 等待拉高  并设置超时</span></pre></td></tr><tr><td data-num="98"></td><td><pre>      ucharFLAG<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="99"></td><td><pre>      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>wenshi<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>ucharFLAG<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 拉高完成  接下来将会开始传输数据</span></pre></td></tr><tr><td data-num="100"></td><td><pre>      <span class="token function">COM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 调用读取函数</span></pre></td></tr><tr><td data-num="101"></td><td><pre>      ucharRH_data_H_temp<span class="token operator">=</span>ucharcomdata<span class="token punctuation">;</span> <span class="token comment">// 读取出湿度高 8</span></pre></td></tr><tr><td data-num="102"></td><td><pre>      <span class="token function">COM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>      ucharRH_data_L_temp<span class="token operator">=</span>ucharcomdata<span class="token punctuation">;</span> <span class="token comment">// 读取出湿度底 8</span></pre></td></tr><tr><td data-num="104"></td><td><pre>      <span class="token function">COM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="105"></td><td><pre>      ucharT_data_H_temp<span class="token operator">=</span>ucharcomdata<span class="token punctuation">;</span> <span class="token comment">// 读取出温度高 8</span></pre></td></tr><tr><td data-num="106"></td><td><pre>      <span class="token function">COM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="107"></td><td><pre>      ucharT_data_L_temp<span class="token operator">=</span>ucharcomdata<span class="token punctuation">;</span>  <span class="token comment">// 读取出温度低 8</span></pre></td></tr><tr><td data-num="108"></td><td><pre>      <span class="token function">COM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="109"></td><td><pre>      ucharcheckdata_temp<span class="token operator">=</span>ucharcomdata<span class="token punctuation">;</span>  <span class="token comment">// 数据校验码</span></pre></td></tr><tr><td data-num="110"></td><td><pre>      wenshi<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment">//// 拉高 DAta</span></pre></td></tr><tr><td data-num="111"></td><td><pre>      uchartemp<span class="token operator">=</span><span class="token punctuation">(</span>ucharT_data_H_temp<span class="token operator">+</span>ucharT_data_L_temp<span class="token operator">+</span>ucharRH_data_H_temp<span class="token operator">+</span>ucharRH_data_L_temp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="112"></td><td><pre>       <span class="token keyword">if</span><span class="token punctuation">(</span>uchartemp<span class="token operator">==</span>ucharcheckdata_temp<span class="token punctuation">)</span> <span class="token comment">// 校验数据</span></pre></td></tr><tr><td data-num="113"></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="114"></td><td><pre>          ucharRH_data_H<span class="token operator">=</span>ucharRH_data_H_temp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="115"></td><td><pre>          ucharRH_data_L<span class="token operator">=</span>ucharRH_data_L_temp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="116"></td><td><pre>          ucharT_data_H<span class="token operator">=</span>ucharT_data_H_temp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="117"></td><td><pre>          ucharT_data_L<span class="token operator">=</span>ucharT_data_L_temp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="118"></td><td><pre>          ucharcheckdata<span class="token operator">=</span>ucharcheckdata_temp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="119"></td><td><pre>       <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="120"></td><td><pre>         wendu_shi<span class="token operator">=</span>ucharT_data_H<span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="121"></td><td><pre>         wendu_ge<span class="token operator">=</span>ucharT_data_H<span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="122"></td><td><pre>	 </pre></td></tr><tr><td data-num="123"></td><td><pre>         shidu_shi<span class="token operator">=</span>ucharRH_data_H<span class="token operator">/</span><span class="token number">10</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="124"></td><td><pre>         shidu_ge<span class="token operator">=</span>ucharRH_data_H<span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">;</span>        </pre></td></tr><tr><td data-num="125"></td><td><pre>    <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="126"></td><td><pre>    <span class="token keyword">else</span> <span class="token comment">// 没用成功读取，返回 0</span></pre></td></tr><tr><td data-num="127"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="128"></td><td><pre>         wendu_shi<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="129"></td><td><pre>         wendu_ge<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="130"></td><td><pre>	 </pre></td></tr><tr><td data-num="131"></td><td><pre>         shidu_shi<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="132"></td><td><pre>         shidu_ge<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="133"></td><td><pre>    <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="134"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="zstack代码"><a class="anchor" href="#zstack代码">#</a> ZStack 代码</h4><p>DHT11 驱动代码 分析 同裸机代码</p><figure class="highlight c"><figcaption data-lang="c"><span>c</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**************************************************************************************************</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  Filename:       SampleApp.c</pre></td></tr><tr><td data-num="3"></td><td><pre>  Revised:        $Date: 2009-03-18 15:56:27 -0700 (Wed, 18 Mar 2009) $</pre></td></tr><tr><td data-num="4"></td><td><pre>  Revision:       $Revision: 19453 $</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>  Description:    Sample Application (no Profile).</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>  Copyright 2007 Texas Instruments Incorporated. All rights reserved.</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>  IMPORTANT: Your use of this Software is limited to those specific rights</pre></td></tr><tr><td data-num="12"></td><td><pre>  granted under the terms of a software license agreement between the user</pre></td></tr><tr><td data-num="13"></td><td><pre>  who downloaded the software, his/her employer (which must be your employer)</pre></td></tr><tr><td data-num="14"></td><td><pre>  and Texas Instruments Incorporated (the "License").  You may not use this</pre></td></tr><tr><td data-num="15"></td><td><pre>  Software unless you agree to abide by the terms of the License. The License</pre></td></tr><tr><td data-num="16"></td><td><pre>  limits your use, and you acknowledge, that the Software may not be modified,</pre></td></tr><tr><td data-num="17"></td><td><pre>  copied or distributed unless embedded on a Texas Instruments microcontroller</pre></td></tr><tr><td data-num="18"></td><td><pre>  or used solely and exclusively in conjunction with a Texas Instruments radio</pre></td></tr><tr><td data-num="19"></td><td><pre>  frequency transceiver, which is integrated into your product.  Other than for</pre></td></tr><tr><td data-num="20"></td><td><pre>  the foregoing purpose, you may not use, reproduce, copy, prepare derivative</pre></td></tr><tr><td data-num="21"></td><td><pre>  works of, modify, distribute, perform, display or sell this Software and/or</pre></td></tr><tr><td data-num="22"></td><td><pre>  its documentation for any purpose.</pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>  YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE</pre></td></tr><tr><td data-num="25"></td><td><pre>  PROVIDED 揂 S IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,</pre></td></tr><tr><td data-num="26"></td><td><pre>  INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,</pre></td></tr><tr><td data-num="27"></td><td><pre>  NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL</pre></td></tr><tr><td data-num="28"></td><td><pre>  TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,</pre></td></tr><tr><td data-num="29"></td><td><pre>  NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER</pre></td></tr><tr><td data-num="30"></td><td><pre>  LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES</pre></td></tr><tr><td data-num="31"></td><td><pre>  INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE</pre></td></tr><tr><td data-num="32"></td><td><pre>  OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT</pre></td></tr><tr><td data-num="33"></td><td><pre>  OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES</pre></td></tr><tr><td data-num="34"></td><td><pre>  (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.</pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre>  Should you have any questions regarding your right to use this Software,</pre></td></tr><tr><td data-num="37"></td><td><pre>  contact Texas Instruments Incorporated at www.TI.com.</pre></td></tr><tr><td data-num="38"></td><td><pre>**************************************************************************************************/</pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="41"></td><td><pre>  This application isn't intended to do anything useful, it is</pre></td></tr><tr><td data-num="42"></td><td><pre>  intended to be a simple example of an application's structure.</pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre>  This application sends it's messages either as broadcast or</pre></td></tr><tr><td data-num="45"></td><td><pre>  broadcast filtered group messages.  The other (more normal)</pre></td></tr><tr><td data-num="46"></td><td><pre>  message addressing is unicast.  Most of the other sample</pre></td></tr><tr><td data-num="47"></td><td><pre>  applications are written to support the unicast message model.</pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>  Key control:</pre></td></tr><tr><td data-num="50"></td><td><pre>    SW1:  Sends a flash command to all devices in Group 1.</pre></td></tr><tr><td data-num="51"></td><td><pre>    SW2:  Adds/Removes (toggles) this device in and out</pre></td></tr><tr><td data-num="52"></td><td><pre>          of Group 1.  This will enable and disable the</pre></td></tr><tr><td data-num="53"></td><td><pre>          reception of the flash command.</pre></td></tr><tr><td data-num="54"></td><td><pre>*********************************************************************/</pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="57"></td><td><pre> * INCLUDES</pre></td></tr><tr><td data-num="58"></td><td><pre> */</pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"OSAL.h"</span></span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ZGlobals.h"</span></span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"AF.h"</span></span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"aps_groups.h"</span></span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ZDApp.h"</span></span></pre></td></tr><tr><td data-num="64"></td><td><pre></pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"SampleApp.h"</span></span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"SampleAppHw.h"</span></span></pre></td></tr><tr><td data-num="67"></td><td><pre></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"OnBoard.h"</span></span></pre></td></tr><tr><td data-num="69"></td><td><pre></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token comment">/* HAL */</span></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"hal_lcd.h"</span></span></pre></td></tr><tr><td data-num="72"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"hal_led.h"</span></span></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"hal_key.h"</span></span></pre></td></tr><tr><td data-num="74"></td><td><pre></pre></td></tr><tr><td data-num="75"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>  <span class="token string">"MT_UART.h"</span> <span class="token comment">// 此处用于串口</span></span></pre></td></tr><tr><td data-num="76"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span>  <span class="token string">"DHT11.h"</span>   <span class="token comment">// 温湿度专用</span></span></pre></td></tr><tr><td data-num="77"></td><td><pre></pre></td></tr><tr><td data-num="78"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="79"></td><td><pre> * MACROS</pre></td></tr><tr><td data-num="80"></td><td><pre> */</pre></td></tr><tr><td data-num="81"></td><td><pre></pre></td></tr><tr><td data-num="82"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="83"></td><td><pre> * CONSTANTS</pre></td></tr><tr><td data-num="84"></td><td><pre> */</pre></td></tr><tr><td data-num="85"></td><td><pre></pre></td></tr><tr><td data-num="86"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="87"></td><td><pre> * TYPEDEFS</pre></td></tr><tr><td data-num="88"></td><td><pre> */</pre></td></tr><tr><td data-num="89"></td><td><pre></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="91"></td><td><pre> * GLOBAL VARIABLES</pre></td></tr><tr><td data-num="92"></td><td><pre> */</pre></td></tr><tr><td data-num="93"></td><td><pre></pre></td></tr><tr><td data-num="94"></td><td><pre><span class="token comment">// This list should be filled with Application specific Cluster IDs.</span></pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token keyword">const</span> <span class="token class-name">cId_t</span> SampleApp_ClusterList<span class="token punctuation">[</span>SAMPLEAPP_MAX_CLUSTERS<span class="token punctuation">]</span> <span class="token operator">=</span></pre></td></tr><tr><td data-num="96"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="97"></td><td><pre>  SAMPLEAPP_PERIODIC_CLUSTERID<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="98"></td><td><pre>  SAMPLEAPP_FLASH_CLUSTERID</pre></td></tr><tr><td data-num="99"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="100"></td><td><pre></pre></td></tr><tr><td data-num="101"></td><td><pre><span class="token keyword">const</span> SimpleDescriptionFormat_t SampleApp_SimpleDesc <span class="token operator">=</span></pre></td></tr><tr><td data-num="102"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>  SAMPLEAPP_ENDPOINT<span class="token punctuation">,</span>              <span class="token comment">//  int Endpoint;</span></pre></td></tr><tr><td data-num="104"></td><td><pre>  SAMPLEAPP_PROFID<span class="token punctuation">,</span>                <span class="token comment">//  uint16 AppProfId[2];</span></pre></td></tr><tr><td data-num="105"></td><td><pre>  SAMPLEAPP_DEVICEID<span class="token punctuation">,</span>              <span class="token comment">//  uint16 AppDeviceId[2];</span></pre></td></tr><tr><td data-num="106"></td><td><pre>  SAMPLEAPP_DEVICE_VERSION<span class="token punctuation">,</span>        <span class="token comment">//  int   AppDevVer:4;</span></pre></td></tr><tr><td data-num="107"></td><td><pre>  SAMPLEAPP_FLAGS<span class="token punctuation">,</span>                 <span class="token comment">//  int   AppFlags:4;</span></pre></td></tr><tr><td data-num="108"></td><td><pre>  SAMPLEAPP_MAX_CLUSTERS<span class="token punctuation">,</span>          <span class="token comment">//  uint8  AppNumInClusters;</span></pre></td></tr><tr><td data-num="109"></td><td><pre>  <span class="token punctuation">(</span><span class="token class-name">cId_t</span> <span class="token operator">*</span><span class="token punctuation">)</span>SampleApp_ClusterList<span class="token punctuation">,</span>  <span class="token comment">//  uint8 *pAppInClusterList;</span></pre></td></tr><tr><td data-num="110"></td><td><pre>  SAMPLEAPP_MAX_CLUSTERS<span class="token punctuation">,</span>          <span class="token comment">//  uint8  AppNumInClusters;</span></pre></td></tr><tr><td data-num="111"></td><td><pre>  <span class="token punctuation">(</span><span class="token class-name">cId_t</span> <span class="token operator">*</span><span class="token punctuation">)</span>SampleApp_ClusterList   <span class="token comment">//  uint8 *pAppInClusterList;</span></pre></td></tr><tr><td data-num="112"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="113"></td><td><pre></pre></td></tr><tr><td data-num="114"></td><td><pre><span class="token comment">// This is the Endpoint/Interface description.  It is defined here, but</span></pre></td></tr><tr><td data-num="115"></td><td><pre><span class="token comment">// filled-in in SampleApp_Init().  Another way to go would be to fill</span></pre></td></tr><tr><td data-num="116"></td><td><pre><span class="token comment">// in the structure here and make it a "const" (in code space).  The</span></pre></td></tr><tr><td data-num="117"></td><td><pre><span class="token comment">// way it's defined in this sample app it is define in RAM.</span></pre></td></tr><tr><td data-num="118"></td><td><pre><span class="token class-name">endPointDesc_t</span> SampleApp_epDesc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="119"></td><td><pre></pre></td></tr><tr><td data-num="120"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="121"></td><td><pre> * EXTERNAL VARIABLES</pre></td></tr><tr><td data-num="122"></td><td><pre> */</pre></td></tr><tr><td data-num="123"></td><td><pre></pre></td></tr><tr><td data-num="124"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="125"></td><td><pre> * EXTERNAL FUNCTIONS</pre></td></tr><tr><td data-num="126"></td><td><pre> */</pre></td></tr><tr><td data-num="127"></td><td><pre></pre></td></tr><tr><td data-num="128"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="129"></td><td><pre> * LOCAL VARIABLES</pre></td></tr><tr><td data-num="130"></td><td><pre> */</pre></td></tr><tr><td data-num="131"></td><td><pre>uint8 SampleApp_TaskID<span class="token punctuation">;</span>   <span class="token comment">// Task ID for internal task/event processing</span></pre></td></tr><tr><td data-num="132"></td><td><pre>                          <span class="token comment">// This variable will be received when</span></pre></td></tr><tr><td data-num="133"></td><td><pre>                          <span class="token comment">// SampleApp_Init() is called.</span></pre></td></tr><tr><td data-num="134"></td><td><pre><span class="token class-name">devStates_t</span> SampleApp_NwkState<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="135"></td><td><pre></pre></td></tr><tr><td data-num="136"></td><td><pre>uint8 SampleApp_TransID<span class="token punctuation">;</span>  <span class="token comment">// This is the unique message ID (counter)</span></pre></td></tr><tr><td data-num="137"></td><td><pre></pre></td></tr><tr><td data-num="138"></td><td><pre><span class="token class-name">afAddrType_t</span> SampleApp_Periodic_DstAddr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="139"></td><td><pre><span class="token class-name">afAddrType_t</span> SampleApp_Flash_DstAddr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="140"></td><td><pre></pre></td></tr><tr><td data-num="141"></td><td><pre><span class="token class-name">afAddrType_t</span> Point_To_Point_DstAddr<span class="token punctuation">;</span><span class="token comment">// 网蜂点对点通信定义</span></pre></td></tr><tr><td data-num="142"></td><td><pre></pre></td></tr><tr><td data-num="143"></td><td><pre><span class="token class-name">aps_Group_t</span> SampleApp_Group<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="144"></td><td><pre></pre></td></tr><tr><td data-num="145"></td><td><pre>uint8 SampleAppPeriodicCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="146"></td><td><pre>uint8 SampleAppFlashCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="147"></td><td><pre></pre></td></tr><tr><td data-num="148"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="149"></td><td><pre> * LOCAL FUNCTIONS</pre></td></tr><tr><td data-num="150"></td><td><pre> */</pre></td></tr><tr><td data-num="151"></td><td><pre><span class="token keyword">void</span> <span class="token function">SampleApp_HandleKeys</span><span class="token punctuation">(</span> uint8 shift<span class="token punctuation">,</span> uint8 keys <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="152"></td><td><pre><span class="token keyword">void</span> <span class="token function">SampleApp_MessageMSGCB</span><span class="token punctuation">(</span> <span class="token class-name">afIncomingMSGPacket_t</span> <span class="token operator">*</span>pckt <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="153"></td><td><pre><span class="token keyword">void</span> <span class="token function">SampleApp_SendPeriodicMessage</span><span class="token punctuation">(</span> <span class="token keyword">void</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="154"></td><td><pre><span class="token keyword">void</span> <span class="token function">SampleApp_SendFlashMessage</span><span class="token punctuation">(</span> uint16 flashTime <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="155"></td><td><pre><span class="token keyword">void</span> <span class="token function">SampleApp_SendPointToPointMessage</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="156"></td><td><pre></pre></td></tr><tr><td data-num="157"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="158"></td><td><pre> * NETWORK LAYER CALLBACKS</pre></td></tr><tr><td data-num="159"></td><td><pre> */</pre></td></tr><tr><td data-num="160"></td><td><pre></pre></td></tr><tr><td data-num="161"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="162"></td><td><pre> * PUBLIC FUNCTIONS</pre></td></tr><tr><td data-num="163"></td><td><pre> */</pre></td></tr><tr><td data-num="164"></td><td><pre></pre></td></tr><tr><td data-num="165"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="166"></td><td><pre> * @fn      SampleApp_Init</pre></td></tr><tr><td data-num="167"></td><td><pre> *</pre></td></tr><tr><td data-num="168"></td><td><pre> * @brief   Initialization function for the Generic App Task.</pre></td></tr><tr><td data-num="169"></td><td><pre> *          This is called during initialization and should contain</pre></td></tr><tr><td data-num="170"></td><td><pre> *          any application specific initialization (ie. hardware</pre></td></tr><tr><td data-num="171"></td><td><pre> *          initialization/setup, table initialization, power up</pre></td></tr><tr><td data-num="172"></td><td><pre> *          notificaiton ... ).</pre></td></tr><tr><td data-num="173"></td><td><pre> *</pre></td></tr><tr><td data-num="174"></td><td><pre> * @param   task_id - the ID assigned by OSAL.  This ID should be</pre></td></tr><tr><td data-num="175"></td><td><pre> *                    used to send messages and set timers.</pre></td></tr><tr><td data-num="176"></td><td><pre> *</pre></td></tr><tr><td data-num="177"></td><td><pre> * @return  none</pre></td></tr><tr><td data-num="178"></td><td><pre> */</pre></td></tr><tr><td data-num="179"></td><td><pre><span class="token keyword">void</span> <span class="token function">SampleApp_Init</span><span class="token punctuation">(</span> uint8 task_id <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="180"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="181"></td><td><pre>  SampleApp_TaskID <span class="token operator">=</span> task_id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="182"></td><td><pre>  SampleApp_NwkState <span class="token operator">=</span> DEV_INIT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="183"></td><td><pre>  SampleApp_TransID <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="184"></td><td><pre>  </pre></td></tr><tr><td data-num="185"></td><td><pre>  <span class="token function">MT_UartInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 串口初始化</span></pre></td></tr><tr><td data-num="186"></td><td><pre>  <span class="token function">MT_UartRegisterTaskID</span><span class="token punctuation">(</span>task_id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 登记任务号</span></pre></td></tr><tr><td data-num="187"></td><td><pre>  <span class="token function">HalUARTWrite</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"Hello World\n"</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//（串口 0，' 字符 '，字符个数。）</span></pre></td></tr><tr><td data-num="188"></td><td><pre>  </pre></td></tr><tr><td data-num="189"></td><td><pre>  <span class="token comment">// 温湿度传感器初始化 P0.6</span></pre></td></tr><tr><td data-num="190"></td><td><pre>  P0SEL <span class="token operator">&amp;=</span> <span class="token number">0xbf</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="191"></td><td><pre>  </pre></td></tr><tr><td data-num="192"></td><td><pre>  <span class="token comment">// Device hardware initialization can be added here or in main() (Zmain.c).</span></pre></td></tr><tr><td data-num="193"></td><td><pre>  <span class="token comment">// If the hardware is application specific - add it here.</span></pre></td></tr><tr><td data-num="194"></td><td><pre>  <span class="token comment">// If the hardware is other parts of the device add it in main().</span></pre></td></tr><tr><td data-num="195"></td><td><pre></pre></td></tr><tr><td data-num="196"></td><td><pre> <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span> <span class="token punctuation">(</span> BUILD_ALL_DEVICES <span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="197"></td><td><pre>  <span class="token comment">// The "Demo" target is setup to have BUILD_ALL_DEVICES and HOLD_AUTO_START</span></pre></td></tr><tr><td data-num="198"></td><td><pre>  <span class="token comment">// We are looking at a jumper (defined in SampleAppHw.c) to be jumpered</span></pre></td></tr><tr><td data-num="199"></td><td><pre>  <span class="token comment">// together - if they are - we will start up a coordinator. Otherwise,</span></pre></td></tr><tr><td data-num="200"></td><td><pre>  <span class="token comment">// the device will start as a router.</span></pre></td></tr><tr><td data-num="201"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">readCoordinatorJumper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="202"></td><td><pre>    zgDeviceLogicalType <span class="token operator">=</span> ZG_DEVICETYPE_COORDINATOR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="203"></td><td><pre>  <span class="token keyword">else</span></pre></td></tr><tr><td data-num="204"></td><td><pre>    zgDeviceLogicalType <span class="token operator">=</span> ZG_DEVICETYPE_ROUTER<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="205"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// BUILD_ALL_DEVICES</span></span></pre></td></tr><tr><td data-num="206"></td><td><pre></pre></td></tr><tr><td data-num="207"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span> <span class="token punctuation">(</span> HOLD_AUTO_START <span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="208"></td><td><pre>  <span class="token comment">// HOLD_AUTO_START is a compile option that will surpress ZDApp</span></pre></td></tr><tr><td data-num="209"></td><td><pre>  <span class="token comment">//  from starting the device and wait for the application to</span></pre></td></tr><tr><td data-num="210"></td><td><pre>  <span class="token comment">//  start the device.</span></pre></td></tr><tr><td data-num="211"></td><td><pre>  <span class="token function">ZDOInitDevice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="212"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num="213"></td><td><pre></pre></td></tr><tr><td data-num="214"></td><td><pre>  <span class="token comment">// Setup for the periodic message's destination address</span></pre></td></tr><tr><td data-num="215"></td><td><pre>  <span class="token comment">// Broadcast to everyone</span></pre></td></tr><tr><td data-num="216"></td><td><pre>  SampleApp_Periodic_DstAddr<span class="token punctuation">.</span>addrMode <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">afAddrMode_t</span><span class="token punctuation">)</span>AddrBroadcast<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="217"></td><td><pre>  SampleApp_Periodic_DstAddr<span class="token punctuation">.</span>endPoint <span class="token operator">=</span> SAMPLEAPP_ENDPOINT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="218"></td><td><pre>  SampleApp_Periodic_DstAddr<span class="token punctuation">.</span>addr<span class="token punctuation">.</span>shortAddr <span class="token operator">=</span> <span class="token number">0xFFFF</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="219"></td><td><pre></pre></td></tr><tr><td data-num="220"></td><td><pre>  <span class="token comment">// Setup for the flash command's destination address - Group 1</span></pre></td></tr><tr><td data-num="221"></td><td><pre>  SampleApp_Flash_DstAddr<span class="token punctuation">.</span>addrMode <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">afAddrMode_t</span><span class="token punctuation">)</span>afAddrGroup<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="222"></td><td><pre>  SampleApp_Flash_DstAddr<span class="token punctuation">.</span>endPoint <span class="token operator">=</span> SAMPLEAPP_ENDPOINT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="223"></td><td><pre>  SampleApp_Flash_DstAddr<span class="token punctuation">.</span>addr<span class="token punctuation">.</span>shortAddr <span class="token operator">=</span> SAMPLEAPP_FLASH_GROUP<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="224"></td><td><pre>  </pre></td></tr><tr><td data-num="225"></td><td><pre>  <span class="token comment">// 网蜂点对点通讯定义</span></pre></td></tr><tr><td data-num="226"></td><td><pre>    Point_To_Point_DstAddr<span class="token punctuation">.</span>addrMode <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">afAddrMode_t</span><span class="token punctuation">)</span>Addr16Bit<span class="token punctuation">;</span><span class="token comment">// 点播</span></pre></td></tr><tr><td data-num="227"></td><td><pre>    Point_To_Point_DstAddr<span class="token punctuation">.</span>endPoint <span class="token operator">=</span> SAMPLEAPP_ENDPOINT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="228"></td><td><pre>    Point_To_Point_DstAddr<span class="token punctuation">.</span>addr<span class="token punctuation">.</span>shortAddr <span class="token operator">=</span> <span class="token number">0x0000</span><span class="token punctuation">;</span> <span class="token comment">// 发给协调器</span></pre></td></tr><tr><td data-num="229"></td><td><pre></pre></td></tr><tr><td data-num="230"></td><td><pre></pre></td></tr><tr><td data-num="231"></td><td><pre>  <span class="token comment">// Fill out the endpoint description.</span></pre></td></tr><tr><td data-num="232"></td><td><pre>  SampleApp_epDesc<span class="token punctuation">.</span>endPoint <span class="token operator">=</span> SAMPLEAPP_ENDPOINT<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="233"></td><td><pre>  SampleApp_epDesc<span class="token punctuation">.</span>task_id <span class="token operator">=</span> <span class="token operator">&amp;</span>SampleApp_TaskID<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="234"></td><td><pre>  SampleApp_epDesc<span class="token punctuation">.</span>simpleDesc</pre></td></tr><tr><td data-num="235"></td><td><pre>            <span class="token operator">=</span> <span class="token punctuation">(</span>SimpleDescriptionFormat_t <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>SampleApp_SimpleDesc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="236"></td><td><pre>  SampleApp_epDesc<span class="token punctuation">.</span>latencyReq <span class="token operator">=</span> noLatencyReqs<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="237"></td><td><pre></pre></td></tr><tr><td data-num="238"></td><td><pre>  <span class="token comment">// Register the endpoint description with the AF</span></pre></td></tr><tr><td data-num="239"></td><td><pre>  <span class="token function">afRegister</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>SampleApp_epDesc <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="240"></td><td><pre></pre></td></tr><tr><td data-num="241"></td><td><pre>  <span class="token comment">// Register for all key events - This app will handle all key events</span></pre></td></tr><tr><td data-num="242"></td><td><pre>  <span class="token function">RegisterForKeys</span><span class="token punctuation">(</span> SampleApp_TaskID <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="243"></td><td><pre></pre></td></tr><tr><td data-num="244"></td><td><pre>  <span class="token comment">// By default, all devices start out in Group 1</span></pre></td></tr><tr><td data-num="245"></td><td><pre>  SampleApp_Group<span class="token punctuation">.</span>ID <span class="token operator">=</span> <span class="token number">0x0001</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="246"></td><td><pre>  <span class="token function">osal_memcpy</span><span class="token punctuation">(</span> SampleApp_Group<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">"Group 1"</span><span class="token punctuation">,</span> <span class="token number">7</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="247"></td><td><pre>  <span class="token function">aps_AddGroup</span><span class="token punctuation">(</span> SAMPLEAPP_ENDPOINT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>SampleApp_Group <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="248"></td><td><pre></pre></td></tr><tr><td data-num="249"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span> <span class="token punctuation">(</span> LCD_SUPPORTED <span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="250"></td><td><pre>  <span class="token function">HalLcdWriteString</span><span class="token punctuation">(</span> <span class="token string">"SampleApp"</span><span class="token punctuation">,</span> HAL_LCD_LINE_1 <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="251"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num="252"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="253"></td><td><pre></pre></td></tr><tr><td data-num="254"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="255"></td><td><pre> * @fn      SampleApp_ProcessEvent</pre></td></tr><tr><td data-num="256"></td><td><pre> *</pre></td></tr><tr><td data-num="257"></td><td><pre> * @brief   Generic Application Task event processor.  This function</pre></td></tr><tr><td data-num="258"></td><td><pre> *          is called to process all events for the task.  Events</pre></td></tr><tr><td data-num="259"></td><td><pre> *          include timers, messages and any other user defined events.</pre></td></tr><tr><td data-num="260"></td><td><pre> *</pre></td></tr><tr><td data-num="261"></td><td><pre> * @param   task_id  - The OSAL assigned task ID.</pre></td></tr><tr><td data-num="262"></td><td><pre> * @param   events - events to process.  This is a bit map and can</pre></td></tr><tr><td data-num="263"></td><td><pre> *                   contain more than one event.</pre></td></tr><tr><td data-num="264"></td><td><pre> *</pre></td></tr><tr><td data-num="265"></td><td><pre> * @return  none</pre></td></tr><tr><td data-num="266"></td><td><pre> */</pre></td></tr><tr><td data-num="267"></td><td><pre>uint16 <span class="token function">SampleApp_ProcessEvent</span><span class="token punctuation">(</span> uint8 task_id<span class="token punctuation">,</span> uint16 events <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="268"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="269"></td><td><pre>  <span class="token class-name">afIncomingMSGPacket_t</span> <span class="token operator">*</span>MSGpkt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="270"></td><td><pre>  <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>task_id<span class="token punctuation">;</span>  <span class="token comment">// Intentionally unreferenced parameter</span></pre></td></tr><tr><td data-num="271"></td><td><pre></pre></td></tr><tr><td data-num="272"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span> events <span class="token operator">&amp;</span> SYS_EVENT_MSG <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="273"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="274"></td><td><pre>    MSGpkt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">afIncomingMSGPacket_t</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">osal_msg_receive</span><span class="token punctuation">(</span> SampleApp_TaskID <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="275"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span> MSGpkt <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="276"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="277"></td><td><pre>      <span class="token keyword">switch</span> <span class="token punctuation">(</span> MSGpkt<span class="token operator">-></span>hdr<span class="token punctuation">.</span>event <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="278"></td><td><pre>      <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="279"></td><td><pre>        <span class="token comment">// Received when a key is pressed</span></pre></td></tr><tr><td data-num="280"></td><td><pre>        <span class="token keyword">case</span> KEY_CHANGE<span class="token operator">:</span></pre></td></tr><tr><td data-num="281"></td><td><pre>          <span class="token function">SampleApp_HandleKeys</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">keyChange_t</span> <span class="token operator">*</span><span class="token punctuation">)</span>MSGpkt<span class="token punctuation">)</span><span class="token operator">-></span>state<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">keyChange_t</span> <span class="token operator">*</span><span class="token punctuation">)</span>MSGpkt<span class="token punctuation">)</span><span class="token operator">-></span>keys <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="282"></td><td><pre>          <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="283"></td><td><pre></pre></td></tr><tr><td data-num="284"></td><td><pre>        <span class="token comment">// Received when a messages is received (OTA) for this endpoint</span></pre></td></tr><tr><td data-num="285"></td><td><pre>        <span class="token keyword">case</span> AF_INCOMING_MSG_CMD<span class="token operator">:</span></pre></td></tr><tr><td data-num="286"></td><td><pre>          <span class="token function">SampleApp_MessageMSGCB</span><span class="token punctuation">(</span> MSGpkt <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="287"></td><td><pre>          <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="288"></td><td><pre></pre></td></tr><tr><td data-num="289"></td><td><pre>        <span class="token comment">// Received whenever the device changes state in the network</span></pre></td></tr><tr><td data-num="290"></td><td><pre>        <span class="token keyword">case</span> ZDO_STATE_CHANGE<span class="token operator">:</span></pre></td></tr><tr><td data-num="291"></td><td><pre>          SampleApp_NwkState <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">devStates_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span>MSGpkt<span class="token operator">-></span>hdr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="292"></td><td><pre>          <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token comment">//(SampleApp_NwkState == DEV_ZB_COORD)|| // 协调器不给自己点播</span></pre></td></tr><tr><td data-num="293"></td><td><pre>               <span class="token punctuation">(</span>SampleApp_NwkState <span class="token operator">==</span> DEV_ROUTER<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="294"></td><td><pre>              <span class="token operator">||</span> <span class="token punctuation">(</span>SampleApp_NwkState <span class="token operator">==</span> DEV_END_DEVICE<span class="token punctuation">)</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="295"></td><td><pre>          <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="296"></td><td><pre>            <span class="token comment">// Start sending the periodic message in a regular interval.</span></pre></td></tr><tr><td data-num="297"></td><td><pre>            <span class="token function">osal_start_timerEx</span><span class="token punctuation">(</span> SampleApp_TaskID<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="298"></td><td><pre>                              SAMPLEAPP_SEND_PERIODIC_MSG_EVT<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="299"></td><td><pre>                              SAMPLEAPP_SEND_PERIODIC_MSG_TIMEOUT <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="300"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="301"></td><td><pre>          <span class="token keyword">else</span></pre></td></tr><tr><td data-num="302"></td><td><pre>          <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="303"></td><td><pre>            <span class="token comment">// Device is no longer in the network</span></pre></td></tr><tr><td data-num="304"></td><td><pre>          <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="305"></td><td><pre>          <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="306"></td><td><pre></pre></td></tr><tr><td data-num="307"></td><td><pre>        <span class="token keyword">default</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="308"></td><td><pre>          <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="309"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="310"></td><td><pre></pre></td></tr><tr><td data-num="311"></td><td><pre>      <span class="token comment">// Release the memory</span></pre></td></tr><tr><td data-num="312"></td><td><pre>      <span class="token function">osal_msg_deallocate</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>uint8 <span class="token operator">*</span><span class="token punctuation">)</span>MSGpkt <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="313"></td><td><pre></pre></td></tr><tr><td data-num="314"></td><td><pre>      <span class="token comment">// Next - if one is available</span></pre></td></tr><tr><td data-num="315"></td><td><pre>      MSGpkt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">afIncomingMSGPacket_t</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">osal_msg_receive</span><span class="token punctuation">(</span> SampleApp_TaskID <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="316"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="317"></td><td><pre></pre></td></tr><tr><td data-num="318"></td><td><pre>    <span class="token comment">// return unprocessed events</span></pre></td></tr><tr><td data-num="319"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">(</span>events <span class="token operator">^</span> SYS_EVENT_MSG<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="320"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="321"></td><td><pre></pre></td></tr><tr><td data-num="322"></td><td><pre>  <span class="token comment">// Send a message out - This event is generated by a timer</span></pre></td></tr><tr><td data-num="323"></td><td><pre>  <span class="token comment">//  (setup in SampleApp_Init()).</span></pre></td></tr><tr><td data-num="324"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span> events <span class="token operator">&amp;</span> SAMPLEAPP_SEND_PERIODIC_MSG_EVT <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="325"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="326"></td><td><pre>    uint8 T<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">// 温度 + 提示符     </span></pre></td></tr><tr><td data-num="327"></td><td><pre>    <span class="token function">DHT11</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 温度检测      调用 DHT11 库 获取温度</span></pre></td></tr><tr><td data-num="328"></td><td><pre>    T<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>wendu_shi<span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">;</span>  <span class="token comment">// 温</span></pre></td></tr><tr><td data-num="329"></td><td><pre>    T<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>wendu_ge<span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">;</span>   <span class="token comment">// 度</span></pre></td></tr><tr><td data-num="330"></td><td><pre>    T<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token char">' '</span><span class="token punctuation">;</span>           <span class="token comment">// 格</span></pre></td></tr><tr><td data-num="331"></td><td><pre>    T<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span>shidu_shi<span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">;</span>  <span class="token comment">// 式</span></pre></td></tr><tr><td data-num="332"></td><td><pre>    T<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span>shidu_ge<span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">;</span>   <span class="token comment">// 化</span></pre></td></tr><tr><td data-num="333"></td><td><pre>    T<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token char">' '</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="334"></td><td><pre>    T<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token char">' '</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="335"></td><td><pre>    T<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token char">' '</span><span class="token punctuation">;</span>   </pre></td></tr><tr><td data-num="336"></td><td><pre>    </pre></td></tr><tr><td data-num="337"></td><td><pre>    <span class="token function">SampleApp_SendPointToPointMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 发送 温度数据到协调器</span></pre></td></tr><tr><td data-num="338"></td><td><pre>    <span class="token comment">// 启动 一个定时的时间 回调  时间是随机的    运行自己</span></pre></td></tr><tr><td data-num="339"></td><td><pre>    <span class="token function">osal_start_timerEx</span><span class="token punctuation">(</span> SampleApp_TaskID<span class="token punctuation">,</span> SAMPLEAPP_SEND_PERIODIC_MSG_EVT<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="340"></td><td><pre>        <span class="token punctuation">(</span>SAMPLEAPP_SEND_PERIODIC_MSG_TIMEOUT <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">osal_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x00FF</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="341"></td><td><pre></pre></td></tr><tr><td data-num="342"></td><td><pre>    <span class="token keyword">return</span> <span class="token punctuation">(</span>events <span class="token operator">^</span> SAMPLEAPP_SEND_PERIODIC_MSG_EVT<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="343"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="344"></td><td><pre></pre></td></tr><tr><td data-num="345"></td><td><pre>  <span class="token comment">// Discard unknown events</span></pre></td></tr><tr><td data-num="346"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="347"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="348"></td><td><pre></pre></td></tr><tr><td data-num="349"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="350"></td><td><pre> * Event Generation Functions</pre></td></tr><tr><td data-num="351"></td><td><pre> */</pre></td></tr><tr><td data-num="352"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="353"></td><td><pre> * @fn      SampleApp_HandleKeys</pre></td></tr><tr><td data-num="354"></td><td><pre> *</pre></td></tr><tr><td data-num="355"></td><td><pre> * @brief   Handles all key events for this device.</pre></td></tr><tr><td data-num="356"></td><td><pre> *</pre></td></tr><tr><td data-num="357"></td><td><pre> * @param   shift - true if in shift/alt.</pre></td></tr><tr><td data-num="358"></td><td><pre> * @param   keys - bit field for key events. Valid entries:</pre></td></tr><tr><td data-num="359"></td><td><pre> *                 HAL_KEY_SW_2</pre></td></tr><tr><td data-num="360"></td><td><pre> *                 HAL_KEY_SW_1</pre></td></tr><tr><td data-num="361"></td><td><pre> *</pre></td></tr><tr><td data-num="362"></td><td><pre> * @return  none</pre></td></tr><tr><td data-num="363"></td><td><pre> */</pre></td></tr><tr><td data-num="364"></td><td><pre><span class="token keyword">void</span> <span class="token function">SampleApp_HandleKeys</span><span class="token punctuation">(</span> uint8 shift<span class="token punctuation">,</span> uint8 keys <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="365"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="366"></td><td><pre>  <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>shift<span class="token punctuation">;</span>  <span class="token comment">// Intentionally unreferenced parameter</span></pre></td></tr><tr><td data-num="367"></td><td><pre>  </pre></td></tr><tr><td data-num="368"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span> keys <span class="token operator">&amp;</span> HAL_KEY_SW_1 <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="369"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="370"></td><td><pre>    <span class="token comment">/* This key sends the Flash Command is sent to Group 1.</span></pre></td></tr><tr><td data-num="371"></td><td><pre>     * This device will not receive the Flash Command from this</pre></td></tr><tr><td data-num="372"></td><td><pre>     * device (even if it belongs to group 1).</pre></td></tr><tr><td data-num="373"></td><td><pre>     */</pre></td></tr><tr><td data-num="374"></td><td><pre>    <span class="token function">SampleApp_SendFlashMessage</span><span class="token punctuation">(</span> SAMPLEAPP_FLASH_DURATION <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="375"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="376"></td><td><pre></pre></td></tr><tr><td data-num="377"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span> keys <span class="token operator">&amp;</span> HAL_KEY_SW_2 <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="378"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="379"></td><td><pre>    <span class="token comment">/* The Flashr Command is sent to Group 1.</span></pre></td></tr><tr><td data-num="380"></td><td><pre>     * This key toggles this device in and out of group 1.</pre></td></tr><tr><td data-num="381"></td><td><pre>     * If this device doesn't belong to group 1, this application</pre></td></tr><tr><td data-num="382"></td><td><pre>     * will not receive the Flash command sent to group 1.</pre></td></tr><tr><td data-num="383"></td><td><pre>     */</pre></td></tr><tr><td data-num="384"></td><td><pre>    <span class="token class-name">aps_Group_t</span> <span class="token operator">*</span>grp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="385"></td><td><pre>    grp <span class="token operator">=</span> <span class="token function">aps_FindGroup</span><span class="token punctuation">(</span> SAMPLEAPP_ENDPOINT<span class="token punctuation">,</span> SAMPLEAPP_FLASH_GROUP <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="386"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span> grp <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="387"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="388"></td><td><pre>      <span class="token comment">// Remove from the group</span></pre></td></tr><tr><td data-num="389"></td><td><pre>      <span class="token function">aps_RemoveGroup</span><span class="token punctuation">(</span> SAMPLEAPP_ENDPOINT<span class="token punctuation">,</span> SAMPLEAPP_FLASH_GROUP <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="390"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="391"></td><td><pre>    <span class="token keyword">else</span></pre></td></tr><tr><td data-num="392"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="393"></td><td><pre>      <span class="token comment">// Add to the flash group</span></pre></td></tr><tr><td data-num="394"></td><td><pre>      <span class="token function">aps_AddGroup</span><span class="token punctuation">(</span> SAMPLEAPP_ENDPOINT<span class="token punctuation">,</span> <span class="token operator">&amp;</span>SampleApp_Group <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="395"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="396"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="397"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="398"></td><td><pre></pre></td></tr><tr><td data-num="399"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="400"></td><td><pre> * LOCAL FUNCTIONS</pre></td></tr><tr><td data-num="401"></td><td><pre> */</pre></td></tr><tr><td data-num="402"></td><td><pre></pre></td></tr><tr><td data-num="403"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="404"></td><td><pre> * @fn      SampleApp_MessageMSGCB</pre></td></tr><tr><td data-num="405"></td><td><pre> *</pre></td></tr><tr><td data-num="406"></td><td><pre> * @brief   Data message processor callback.  This function processes</pre></td></tr><tr><td data-num="407"></td><td><pre> *          any incoming data - probably from other devices.  So, based</pre></td></tr><tr><td data-num="408"></td><td><pre> *          on cluster ID, perform the intended action.</pre></td></tr><tr><td data-num="409"></td><td><pre> *</pre></td></tr><tr><td data-num="410"></td><td><pre> * @param   none</pre></td></tr><tr><td data-num="411"></td><td><pre> *</pre></td></tr><tr><td data-num="412"></td><td><pre> * @return  none</pre></td></tr><tr><td data-num="413"></td><td><pre> */</pre></td></tr><tr><td data-num="414"></td><td><pre><span class="token keyword">void</span> <span class="token function">SampleApp_MessageMSGCB</span><span class="token punctuation">(</span> <span class="token class-name">afIncomingMSGPacket_t</span> <span class="token operator">*</span>pkt <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="415"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="416"></td><td><pre>  uint16 flashTime<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="417"></td><td><pre></pre></td></tr><tr><td data-num="418"></td><td><pre>  <span class="token keyword">switch</span> <span class="token punctuation">(</span> pkt<span class="token operator">-></span>clusterId <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="419"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="420"></td><td><pre>    <span class="token keyword">case</span> SAMPLEAPP_POINT_TO_POINT_CLUSTERID<span class="token operator">:</span></pre></td></tr><tr><td data-num="421"></td><td><pre>       <span class="token comment">/*********** 温度打印 ***************/</span></pre></td></tr><tr><td data-num="422"></td><td><pre>     <span class="token function">HalUARTWrite</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"Temp is:"</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 提示接收到数据</span></pre></td></tr><tr><td data-num="423"></td><td><pre>     <span class="token function">HalUARTWrite</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>pkt<span class="token operator">-></span>cmd<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 温度</span></pre></td></tr><tr><td data-num="424"></td><td><pre>     <span class="token function">HalUARTWrite</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// 回车换行</span></pre></td></tr><tr><td data-num="425"></td><td><pre>      </pre></td></tr><tr><td data-num="426"></td><td><pre>       <span class="token comment">/*************** 湿度打印 ****************/</span></pre></td></tr><tr><td data-num="427"></td><td><pre>     <span class="token function">HalUARTWrite</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"Humidity is:"</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 提示接收到数据</span></pre></td></tr><tr><td data-num="428"></td><td><pre>     <span class="token function">HalUARTWrite</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>pkt<span class="token operator">-></span>cmd<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 湿度</span></pre></td></tr><tr><td data-num="429"></td><td><pre>     <span class="token function">HalUARTWrite</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"\n"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// 回车换行</span></pre></td></tr><tr><td data-num="430"></td><td><pre>      <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="431"></td><td><pre></pre></td></tr><tr><td data-num="432"></td><td><pre>    <span class="token keyword">case</span> SAMPLEAPP_FLASH_CLUSTERID<span class="token operator">:</span></pre></td></tr><tr><td data-num="433"></td><td><pre>      flashTime <span class="token operator">=</span> <span class="token function">BUILD_UINT16</span><span class="token punctuation">(</span>pkt<span class="token operator">-></span>cmd<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pkt<span class="token operator">-></span>cmd<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="434"></td><td><pre>      <span class="token function">HalLedBlink</span><span class="token punctuation">(</span> HAL_LED_4<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>flashTime <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="435"></td><td><pre>      <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="436"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="437"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="438"></td><td><pre></pre></td></tr><tr><td data-num="439"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="440"></td><td><pre> * @fn      SampleApp_SendPeriodicMessage</pre></td></tr><tr><td data-num="441"></td><td><pre> *</pre></td></tr><tr><td data-num="442"></td><td><pre> * @brief   Send the periodic message.</pre></td></tr><tr><td data-num="443"></td><td><pre> *</pre></td></tr><tr><td data-num="444"></td><td><pre> * @param   none</pre></td></tr><tr><td data-num="445"></td><td><pre> *</pre></td></tr><tr><td data-num="446"></td><td><pre> * @return  none</pre></td></tr><tr><td data-num="447"></td><td><pre> */</pre></td></tr><tr><td data-num="448"></td><td><pre><span class="token keyword">void</span> <span class="token function">SampleApp_SendPeriodicMessage</span><span class="token punctuation">(</span> <span class="token keyword">void</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="449"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="450"></td><td><pre>  uint8 data<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token char">'0'</span><span class="token punctuation">,</span><span class="token char">'1'</span><span class="token punctuation">,</span><span class="token char">'2'</span><span class="token punctuation">,</span><span class="token char">'3'</span><span class="token punctuation">,</span><span class="token char">'4'</span><span class="token punctuation">,</span><span class="token char">'5'</span><span class="token punctuation">,</span><span class="token char">'6'</span><span class="token punctuation">,</span><span class="token char">'7'</span><span class="token punctuation">,</span><span class="token char">'8'</span><span class="token punctuation">,</span><span class="token char">'9'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// 自定义数据</span></pre></td></tr><tr><td data-num="451"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">AF_DataRequest</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>SampleApp_Periodic_DstAddr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>SampleApp_epDesc<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="452"></td><td><pre>                       SAMPLEAPP_PERIODIC_CLUSTERID<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="453"></td><td><pre>                       <span class="token number">10</span><span class="token punctuation">,</span><span class="token comment">// 字节数</span></pre></td></tr><tr><td data-num="454"></td><td><pre>                       data<span class="token punctuation">,</span><span class="token comment">// 指针头</span></pre></td></tr><tr><td data-num="455"></td><td><pre>                       <span class="token operator">&amp;</span>SampleApp_TransID<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="456"></td><td><pre>                       AF_DISCV_ROUTE<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="457"></td><td><pre>                       AF_DEFAULT_RADIUS <span class="token punctuation">)</span> <span class="token operator">==</span> afStatus_SUCCESS <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="458"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="459"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="460"></td><td><pre>  <span class="token keyword">else</span></pre></td></tr><tr><td data-num="461"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="462"></td><td><pre>    <span class="token comment">// Error occurred in request to send.</span></pre></td></tr><tr><td data-num="463"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="464"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="465"></td><td><pre></pre></td></tr><tr><td data-num="466"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="467"></td><td><pre> * @fn      SampleApp_SendFlashMessage</pre></td></tr><tr><td data-num="468"></td><td><pre> *</pre></td></tr><tr><td data-num="469"></td><td><pre> * @brief   Send the flash message to group 1.</pre></td></tr><tr><td data-num="470"></td><td><pre> *</pre></td></tr><tr><td data-num="471"></td><td><pre> * @param   flashTime - in milliseconds</pre></td></tr><tr><td data-num="472"></td><td><pre> *</pre></td></tr><tr><td data-num="473"></td><td><pre> * @return  none</pre></td></tr><tr><td data-num="474"></td><td><pre> */</pre></td></tr><tr><td data-num="475"></td><td><pre><span class="token keyword">void</span> <span class="token function">SampleApp_SendFlashMessage</span><span class="token punctuation">(</span> uint16 flashTime <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="476"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="477"></td><td><pre>  uint8 buffer<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="478"></td><td><pre>  buffer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>uint8<span class="token punctuation">)</span><span class="token punctuation">(</span>SampleAppFlashCounter<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="479"></td><td><pre>  buffer<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">LO_UINT16</span><span class="token punctuation">(</span> flashTime <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="480"></td><td><pre>  buffer<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">HI_UINT16</span><span class="token punctuation">(</span> flashTime <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="481"></td><td><pre>        <span class="token comment">/// 发送 温度数据到 协调器</span></pre></td></tr><tr><td data-num="482"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">AF_DataRequest</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>SampleApp_Flash_DstAddr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>SampleApp_epDesc<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="483"></td><td><pre>                       SAMPLEAPP_FLASH_CLUSTERID<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="484"></td><td><pre>                       <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="485"></td><td><pre>                       buffer<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="486"></td><td><pre>                       <span class="token operator">&amp;</span>SampleApp_TransID<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="487"></td><td><pre>                       AF_DISCV_ROUTE<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="488"></td><td><pre>                       AF_DEFAULT_RADIUS <span class="token punctuation">)</span> <span class="token operator">==</span> afStatus_SUCCESS <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="489"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="490"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="491"></td><td><pre>  <span class="token keyword">else</span></pre></td></tr><tr><td data-num="492"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="493"></td><td><pre>    <span class="token comment">// Error occurred in request to send.</span></pre></td></tr><tr><td data-num="494"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="495"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="496"></td><td><pre></pre></td></tr><tr><td data-num="497"></td><td><pre><span class="token comment">/*********************************************************************</span></pre></td></tr><tr><td data-num="498"></td><td><pre>*********************************************************************/</pre></td></tr><tr><td data-num="499"></td><td><pre><span class="token keyword">void</span> <span class="token function">SampleApp_SendPointToPointMessage</span><span class="token punctuation">(</span> <span class="token keyword">void</span> <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="500"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="501"></td><td><pre>  uint8 T_H<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 温湿度</span></pre></td></tr><tr><td data-num="502"></td><td><pre>  T_H<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>wendu_shi<span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="503"></td><td><pre>  T_H<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>wendu_ge<span class="token operator">%</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="504"></td><td><pre>  </pre></td></tr><tr><td data-num="505"></td><td><pre>  T_H<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span>shidu_shi<span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="506"></td><td><pre>  T_H<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span>shidu_ge<span class="token operator">%</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="507"></td><td><pre>  </pre></td></tr><tr><td data-num="508"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">AF_DataRequest</span><span class="token punctuation">(</span> <span class="token operator">&amp;</span>Point_To_Point_DstAddr<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="509"></td><td><pre>                       <span class="token operator">&amp;</span>SampleApp_epDesc<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="510"></td><td><pre>                       SAMPLEAPP_POINT_TO_POINT_CLUSTERID<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="511"></td><td><pre>                       <span class="token number">4</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="512"></td><td><pre>                       T_H<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="513"></td><td><pre>                       <span class="token operator">&amp;</span>SampleApp_TransID<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="514"></td><td><pre>                       AF_DISCV_ROUTE<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="515"></td><td><pre>                       AF_DEFAULT_RADIUS <span class="token punctuation">)</span> <span class="token operator">==</span> afStatus_SUCCESS <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="516"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="517"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="518"></td><td><pre>  <span class="token keyword">else</span></pre></td></tr><tr><td data-num="519"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="520"></td><td><pre>    <span class="token comment">// Error occurred in request to send.</span></pre></td></tr><tr><td data-num="521"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="522"></td><td><pre></pre></td></tr><tr><td data-num="523"></td><td><pre></pre></td></tr><tr><td data-num="524"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><div class="tags"><a href="/tags/Zigbee/" rel="tag"><i class="ic i-tag"></i> Zigbee</a> <a href="/tags/Zstack/" rel="tag"><i class="ic i-tag"></i> Zstack</a> <a href="/tags/DHT11/" rel="tag"><i class="ic i-tag"></i> DHT11</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2023-03-24 10:07:16" itemprop="dateModified" datetime="2023-03-24T10:07:16+08:00">2023-03-24</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="晚晴 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="晚晴 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="晚晴 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>晚晴 <i class="ic i-at"><em>@</em></i>Hexo</li><li class="link"><strong>本文链接：</strong> <a href="https://staysunny66.github.io/2022/12/07/ZIGBEE%E6%B8%A9%E6%B9%BF%E5%BA%A6%E4%BC%A0%E6%84%9F%E5%99%A8%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/" title="ZIGBEE温湿度传感器代码分析">https://staysunny66.github.io/2022/12/07/ZIGBEE温湿度传感器代码分析/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/06/08/%E4%B8%BB%E5%AD%98%E4%B8%8ECACHE%E7%9A%84%E5%9C%B0%E5%9D%80%E6%98%A0%E5%B0%84/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s1.ax1x.com&#x2F;2023&#x2F;03&#x2F;23&#x2F;pp0PvxP.jpg" title="主存与CACHE的地址映射"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 组成原理</span><h3>主存与CACHE的地址映射</h3></a></div><div class="item right"><a href="/2023/02/14/%E4%BB%8E%E5%A4%B4%E5%86%99%E4%B8%80%E4%B8%AA%E5%AE%9E%E6%97%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%EF%BC%88CPU%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2%EF%BC%89%EF%BC%88%E6%B1%87%E7%BC%96%EF%BC%89/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s1.ax1x.com&#x2F;2023&#x2F;03&#x2F;23&#x2F;pp0PvxP.jpg" title="从头写一个实时操作系统（CPU任务切换）（汇编）"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 实时操作系统</span><h3>从头写一个实时操作系统（CPU任务切换）（汇编）</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E6%84%9F%E5%99%A8%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">传感器介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A7%E5%93%81%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">产品详细介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B8%E5%9E%8B%E5%BA%94%E7%94%A8%E7%94%B5%E8%B7%AF"><span class="toc-number">1.2.</span> <span class="toc-text">典型应用电路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E6%84%9F%E5%99%A8%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.</span> <span class="toc-text">传感器协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E6%80%BB%E7%BA%BFonewire%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.1.</span> <span class="toc-text">单总线（OneWire）协议介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE%E5%9B%BE%E7%A4%BA"><span class="toc-number">2.2.</span> <span class="toc-text">协议图示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">代码分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A3%B8%E6%9C%BA%E4%BB%A3%E7%A0%81"><span class="toc-number">3.1.</span> <span class="toc-text">裸机代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#zstack%E4%BB%A3%E7%A0%81"><span class="toc-number">3.2.</span> <span class="toc-text">ZStack 代码</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/2022/12/07/ZIGBEE%E6%B8%A9%E6%B9%BF%E5%BA%A6%E4%BC%A0%E6%84%9F%E5%99%A8%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/" rel="bookmark" title="ZIGBEE温湿度传感器代码分析">ZIGBEE温湿度传感器代码分析</a></li><li><a href="/2023/02/14/%E4%BB%8E%E5%A4%B4%E5%86%99%E4%B8%80%E4%B8%AA%E5%AE%9E%E6%97%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%EF%BC%88CPU%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2%EF%BC%89%EF%BC%88%E6%B1%87%E7%BC%96%EF%BC%89/" rel="bookmark" title="从头写一个实时操作系统（CPU任务切换）（汇编）">从头写一个实时操作系统（CPU任务切换）（汇编）</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="晚晴" data-src="/images/avatar.jpg"><p class="name" itemprop="name">晚晴</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">8</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">7</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">12</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1N0YXlTdW5ueTY2" title="https:&#x2F;&#x2F;github.com&#x2F;StaySunny66"><i class="ic i-github"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTI5MzMzNTcxNg==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;293335716"><i class="ic i-cloud-music"></i></span> <span class="exturl item email" data-url="bWFpbHRvOmd4eW9zQG91dGxvb2suY29t" title="mailto:gxyos@outlook.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/06/08/%E4%B8%BB%E5%AD%98%E4%B8%8ECACHE%E7%9A%84%E5%9C%B0%E5%9D%80%E6%98%A0%E5%B0%84/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2023/02/14/%E4%BB%8E%E5%A4%B4%E5%86%99%E4%B8%80%E4%B8%AA%E5%AE%9E%E6%97%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%EF%BC%88CPU%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2%EF%BC%89%EF%BC%88%E6%B1%87%E7%BC%96%EF%BC%89/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/" title="分类于 嵌入式开发">嵌入式开发</a></div><span><a href="/2022/12/07/ZIGBEE%E6%B8%A9%E6%B9%BF%E5%BA%A6%E4%BC%A0%E6%84%9F%E5%99%A8%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/" title="ZIGBEE温湿度传感器代码分析">ZIGBEE温湿度传感器代码分析</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/" title="分类于 安卓开发">安卓开发</a></div><span><a href="/2023/03/24/%E5%AE%89%E5%8D%93%E5%AE%9E%E7%8E%B0%E5%AF%B9RECYCLERVIEW%E4%B8%AD%E5%AF%B9ITEM%E7%9A%84%E7%9B%91%E5%90%AC/" title="安卓实现对RECYCLERVIEW中对ITEM的监听">安卓实现对RECYCLERVIEW中对ITEM的监听</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" title="分类于 组成原理">组成原理</a></div><span><a href="/2022/06/08/%E4%B8%BB%E5%AD%98%E4%B8%8ECACHE%E7%9A%84%E5%9C%B0%E5%9D%80%E6%98%A0%E5%B0%84/" title="主存与CACHE的地址映射">主存与CACHE的地址映射</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/PHP/" title="分类于 PHP">PHP</a></div><span><a href="/2022/02/24/LNMP%E4%B8%8B%E5%A4%A7%E9%87%8F%E8%AF%B7%E6%B1%82%E4%B8%8B%E6%8A%A5502%E9%94%99%E8%AF%AF%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" title="LNMP下大量请求下报502错误的解决方法">LNMP下大量请求下报502错误的解决方法</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E9%97%B2%E8%B0%88/" title="分类于 闲谈">闲谈</a></div><span><a href="/2023/03/23/%E6%95%85%E4%BA%8B%E7%9A%84%E5%BC%80%E5%A7%8B/" title="故事的开始">故事的开始</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/PHP/" title="分类于 PHP">PHP</a></div><span><a href="/2022/01/08/REDIS-%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%9C%A8-PHP%E4%B8%8A%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" title="REDIS 数据库 在 PHP上的基本使用">REDIS 数据库 在 PHP上的基本使用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%89%A9%E8%81%94%E7%BD%91/" title="分类于 物联网">物联网</a></div><span><a href="/2023/03/23/hello-world/" title="Hello World">Hello World</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/" title="分类于 嵌入式开发">嵌入式开发</a> <i class="ic i-angle-right"></i> <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/%E5%AE%9E%E6%97%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" title="分类于 实时操作系统">实时操作系统</a></div><span><a href="/2023/02/14/%E4%BB%8E%E5%A4%B4%E5%86%99%E4%B8%80%E4%B8%AA%E5%AE%9E%E6%97%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%EF%BC%88CPU%E4%BB%BB%E5%8A%A1%E5%88%87%E6%8D%A2%EF%BC%89%EF%BC%88%E6%B1%87%E7%BC%96%EF%BC%89/" title="从头写一个实时操作系统（CPU任务切换）（汇编）">从头写一个实时操作系统（CPU任务切换）（汇编）</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2022 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-gxyos"></i> </span><span class="author" itemprop="copyrightHolder">晚晴 @ 矢光小屋</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/12/07/ZIGBEE温湿度传感器代码分析/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->